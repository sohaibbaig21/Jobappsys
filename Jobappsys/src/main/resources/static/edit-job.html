<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Edit Job Post | JobAppSys</title>
    <link rel="stylesheet" href="/styles.css">
    <script defer src="/js/api.js"></script>
</head>
<body>
<main class="stack" style="max-width: 600px; margin: 32px auto;">
    <h1>Edit Job Post</h1>

    <div class="card stack">
        <form id="job-post-form" class="stack">
            <label for="title">Job Title</label>
            <input type="text" id="title" required>

            <label for="description">Description</label>
            <textarea id="description" rows="8"></textarea>

            <label for="location">Location</label>
            <input type="text" id="location">

            <label for="employmentType">Employment Type</label>
            <select id="employmentType">
                <option value="Full-time">Full-time</option>
                <option value="Part-time">Part-time</option>
                <option value="Contract">Contract</option>
                <option value="Internship">Internship</option>
            </select>

            <label for="salary">Salary (Optional)</label>
            <input type="number" id="salary">

            <button type="submit" class="btn">Update Job</button>
        </form>
        <div id="status" class="muted" style="margin-top: 10px;"></div>
    </div>

    <div class="row" style="margin-top: 20px;">
        <a href="/employer-dashboard.html" class="btn secondary">Back to Dashboard</a>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        $api.renderHeader();
        const form = document.getElementById('job-post-form');
        const status = document.getElementById('status');
        const jobId = $api.qs('id');

        if (!jobId) {
            status.className = 'error';
            status.textContent = 'Error: No job ID provided.';
            return;
        }

        // Fetch existing job data
        try {
            const response = await $api.apiFetch(`/api/jobs/${jobId}`);
            const job = await response.json();

            document.getElementById('title').value = job.title || '';
            document.getElementById('description').value = job.description || '';
            document.getElementById('location').value = job.location || '';
            document.getElementById('employmentType').value = job.employmentType || 'Full-time';
            document.getElementById('salary').value = job.salary || '';

        } catch (e) {
            status.className = 'error';
            status.textContent = 'Failed to load job: ' + (e.message || 'Unknown error');
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            status.textContent = 'Updating job...';

            const jobData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                location: document.getElementById('location').value,
                employmentType: document.getElementById('employmentType').value,
                salary: parseFloat(document.getElementById('salary').value) || null
            };

            try {
                const response = await $api.apiFetch(`/api/employer/jobs/${jobId}`, {
                    method: 'PUT',
                    body: JSON.stringify(jobData)
                });

                if (response.ok) {
                    status.className = 'success';
                    status.textContent = 'Job updated successfully!';
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Failed to update job');
                }
            } catch (e) {
                status.className = 'error';
                status.textContent = 'Error: ' + e.message;
            }
        });
    });
</script>
</body>
</html>
